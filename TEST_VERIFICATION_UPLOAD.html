<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Verification Upload</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .section { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        input { margin: 10px 0; padding: 5px; }
    </style>
</head>
<body>
    <h1>Test Verification Document Upload</h1>
    
    <div class="section">
        <h3>1. Select a test file</h3>
        <input type="file" id="testFile" accept="image/*,application/pdf,.doc,.docx">
        <button onclick="testUpload()">Upload Test File</button>
        <div id="result"></div>
    </div>

    <div class="section">
        <h3>2. Check existing voters</h3>
        <button onclick="checkVoters()">Check Voters</button>
        <div id="votersResult"></div>
    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        // You need to add your Firebase config here
        const firebaseConfig = {
            // Add your actual Firebase config
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        window.testUpload = async function() {
            const fileInput = document.getElementById('testFile');
            const resultDiv = document.getElementById('result');
            
            if (!fileInput.files[0]) {
                resultDiv.innerHTML = '<div class="error">Please select a file</div>';
                return;
            }

            try {
                const file = fileInput.files[0];
                const testVoterId = 'test_' + Date.now();
                
                resultDiv.innerHTML = '<div>Uploading...</div>';
                
                // Test the same upload process as the registration
                const fileName = `${Date.now()}_${file.name}`;
                const storageRef = ref(storage, `verification_docs/${testVoterId}/${fileName}`);
                
                const snapshot = await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(snapshot.ref);
                
                resultDiv.innerHTML = `
                    <div class="success">
                        <strong>Upload Success!</strong><br>
                        File: ${file.name}<br>
                        Size: ${(file.size / 1024 / 1024).toFixed(2)} MB<br>
                        URL: <a href="${downloadURL}" target="_blank">View File</a>
                    </div>
                `;
                
            } catch (error) {
                console.error('Upload error:', error);
                resultDiv.innerHTML = `<div class="error">Upload failed: ${error.message}</div>`;
            }
        };

        window.checkVoters = async function() {
            const resultDiv = document.getElementById('votersResult');
            
            try {
                resultDiv.innerHTML = '<div>Loading...</div>';
                
                const votersSnapshot = await getDocs(collection(db, 'voters'));
                let html = '<h4>Voters and their documents:</h4>';
                
                votersSnapshot.forEach((doc) => {
                    const voter = doc.data();
                    const hasDoc = voter.verificationDocUrl ? 'YES' : 'NO';
                    const docUrl = voter.verificationDocUrl || 'None';
                    
                    html += `
                        <div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0;">
                            <strong>${voter.fullName || 'Unknown'}</strong><br>
                            Student ID: ${voter.studentId || 'N/A'}<br>
                            Status: ${voter.status || 'N/A'}<br>
                            Has Document: ${hasDoc}<br>
                            ${voter.verificationDocUrl ? `<a href="${voter.verificationDocUrl}" target="_blank">View Document</a>` : 'No document'}
                        </div>
                    `;
                });
                
                resultDiv.innerHTML = html;
                
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        };
    </script>
</body>
</html>